# 技术假设

这些技术假设是基于项目简报中明确的技术栈选择，并为架构师提供了在设计系统时必须遵守的约束和指导。

## 仓库结构

- **Monorepo (单一代码库)**
  - **理由:** 项目包含多个紧密协作的服务（前端、多个Agent服务）和共享的代码（如类型定义、通用工具函数）。Monorepo 结构能够极大地简化依赖管理、代码复用和跨服务重构，是此类项目的最佳实践。

## 服务架构

- **微服务架构 (Sidecar 模式)**
  - **理由:** 每个AI智能体都将作为一个独立的微服务运行。这种架构提供了极高的灵活性和可扩展性，允许我们独立地开发、部署和扩展每个智能体的能力，而不会影响到其他部分。Sidecar模式确保了核心业务逻辑与通用功能（如日志、监控）的分离。
  - **数据访问:** Agent服务必须具备动态连接到不同数据库的能力，以支持“一小说一库”的数据隔离策略。

## 测试要求

- **单元测试优先:** 每个服务和组件都必须有全面的单元测试覆盖。
- **集成测试:** 必须为服务间的关键交互路径（特别是通过Kafka的事件流）编写集成测试。
- **端到端(E2E)测试:** 至少需要一个E2E测试来验证从UI触发到章节最终生成的完整流程。
- **测试便利性:** 后端服务应提供必要的脚本或工具，以便在本地环境中轻松运行测试。

## 额外技术假设和要求

- **类型安全:** 整个项目（前端和后端）必须强制实行严格的类型安全。共享的类型定义应放在Monorepo的共享包中，以确保前端、后端和事件生产者/消费者之间的数据契约一致。
- **配置管理:** 服务的配置（如API密钥、数据库连接字符串、功能开关）必须与代码分离。配置应通过环境变量或专门的配置服务来加载。
- **容器化:** 所有后端服务（Agents, API等）都必须被设计为在Docker容器中运行，并提供相应的Dockerfile。
- **异步处理:** 鉴于系统的事件驱动特性，所有长时间运行的任务（如调用LLM API、处理复杂逻辑）都必须以异步、非阻塞的方式实现，以避免服务进程被夯住。
