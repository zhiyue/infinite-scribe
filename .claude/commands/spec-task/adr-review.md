---
description: Review and finalize ADR drafts through interactive evaluation and decision making
allowed-tools: Bash, Glob, Grep, LS, Read, Write, Edit, MultiEdit, Update, WebSearch, WebFetch, TodoWrite, Task, Agent
argument-hint: <feature-name> [-y]
---

# ADR è¯„å®¡ä¸å†³ç­–

è¯„å®¡å¹¶ç¡®è®¤æ¶æ„å†³ç­–è®°å½•ï¼ˆADRï¼‰ï¼š**$ARGUMENTS**

## ä¸Šä¸‹æ–‡éªŒè¯

### ç°æœ‰è§„èŒƒä¸Šä¸‹æ–‡

- å½“å‰è§„èŒƒç›®å½•ï¼š!`ls -la .tasks/$ARGUMENTS/`
- **ADR ç›®å½•**ï¼š!`ls -la .tasks/$ARGUMENTS/adr/`
- **äº§å“éœ€æ±‚æ–‡æ¡£**ï¼š@.tasks/$ARGUMENTS/prd.md
- **ç³»ç»Ÿéœ€æ±‚æ–‡æ¡£**ï¼š@.tasks/$ARGUMENTS/requirements.md
- è§„èŒƒå…ƒæ•°æ®ï¼š@.tasks/$ARGUMENTS/spec.json

### é¡¹ç›®ä¸Šä¸‹æ–‡

- **é¡¹ç›®æ¶æ„æ–‡æ¡£**ï¼š!`ls -la docs/architecture/ 2>/dev/null || echo "No architecture docs"`
- **ç°æœ‰ ADR å†å²**ï¼š!`find docs -name "*.adr.md" -o -name "ADR-*.md" 2>/dev/null | head -10`
- **æŠ€æœ¯æ ˆé…ç½®**ï¼š@package.json, @pyproject.tomlï¼ˆå¦‚å­˜åœ¨ï¼‰

## ä»»åŠ¡ï¼šè¯„å®¡ ADR å¹¶åšå‡ºå†³ç­–

### 1. æ”¶é›†å’Œåˆ†æ ADR è‰ç¨¿

#### 1.1 æ‰«ææ‰€æœ‰ Proposed çŠ¶æ€çš„ ADR
- è¯»å– `.tasks/$ARGUMENTS/adr/` ç›®å½•ä¸‹æ‰€æœ‰ ADR æ–‡ä»¶
- ç­›é€‰çŠ¶æ€ä¸º "Proposed" çš„ ADR
- æå–å…³é”®ä¿¡æ¯ï¼š
  - å†³ç­–æ ‡é¢˜å’Œ ID
  - é©±åŠ¨å› ç´ ï¼ˆDecision Driversï¼‰
  - è€ƒè™‘çš„é€‰é¡¹ï¼ˆOptionsï¼‰
  - ç›¸å…³éœ€æ±‚ï¼ˆFR/NFRï¼‰

#### 1.2 åˆ†æé¡¹ç›®å½±å“
å¯¹æ¯ä¸ª ADR è¯„ä¼°ï¼š
- **æ¶æ„ä¸€è‡´æ€§**ï¼šä¸ç°æœ‰æ¶æ„çš„å…¼å®¹æ€§
- **æŠ€æœ¯å€ºåŠ¡**ï¼šå¯èƒ½å¼•å…¥çš„æŠ€æœ¯å€ºåŠ¡
- **å›¢é˜Ÿèƒ½åŠ›**ï¼šå›¢é˜Ÿå¯¹æ–¹æ¡ˆçš„ç†Ÿæ‚‰åº¦
- **å®æ–½æˆæœ¬**ï¼šæ—¶é—´ã€èµ„æºã€å­¦ä¹ æ›²çº¿
- **é£é™©ç­‰çº§**ï¼šä½/ä¸­/é«˜

### 2. ç”Ÿæˆè¯„å®¡æŠ¥å‘Š

ä¸ºæ¯ä¸ª ADR ç”Ÿæˆç»“æ„åŒ–çš„è¯„å®¡æŠ¥å‘Šï¼š

```markdown
# ADR è¯„å®¡æŠ¥å‘Š

## æ€»è§ˆ
- **å¾…è¯„å®¡ ADR æ•°é‡**ï¼š[æ•°é‡]
- **å…³é”®å†³ç­–ç‚¹**ï¼š[åˆ—è¡¨]
- **é«˜é£é™©é¡¹**ï¼š[å¦‚æœ‰]

## ADR è¯¦ç»†åˆ†æ

### [ADR-ID]: [Title]

#### å†³ç­–èƒŒæ™¯
- **ä¸šåŠ¡é©±åŠ¨**ï¼š[ä» PRD æå–]
- **æŠ€æœ¯çº¦æŸ**ï¼š[ä»éœ€æ±‚æå–]
- **æ€§èƒ½è¦æ±‚**ï¼š[NFR è¦æ±‚]

#### æ–¹æ¡ˆå¯¹æ¯”åˆ†æ

| ç»´åº¦ | Option 1 | Option 2 | Option 3 |
|------|----------|----------|----------|
| **æ¶æ„ä¸€è‡´æ€§** | [è¯„åˆ†] | [è¯„åˆ†] | [è¯„åˆ†] |
| **å®æ–½å¤æ‚åº¦** | [ä½/ä¸­/é«˜] | [ä½/ä¸­/é«˜] | [ä½/ä¸­/é«˜] |
| **å›¢é˜Ÿç†Ÿæ‚‰åº¦** | [è¯„åˆ†] | [è¯„åˆ†] | [è¯„åˆ†] |
| **é•¿æœŸç»´æŠ¤æ€§** | [è¯„åˆ†] | [è¯„åˆ†] | [è¯„åˆ†] |
| **æ€§èƒ½å½±å“** | [æè¿°] | [æè¿°] | [æè¿°] |
| **æˆæœ¬ä¼°ç®—** | [äººå¤©] | [äººå¤©] | [äººå¤©] |

#### æ¨èæ–¹æ¡ˆ
**æ¨èé€‰æ‹©**ï¼šOption [X]

**ç†ç”±**ï¼š
- [å…³é”®ç†ç”±1]
- [å…³é”®ç†ç”±2]
- [å…³é”®ç†ç”±3]

#### é£é™©ä¸ç¼“è§£
- **é£é™©1**ï¼š[æè¿°] â†’ **ç¼“è§£**ï¼š[æªæ–½]
- **é£é™©2**ï¼š[æè¿°] â†’ **ç¼“è§£**ï¼š[æªæ–½]

#### éªŒè¯å»ºè®®
- [ ] Spike å®éªŒï¼š[å…·ä½“å®éªŒå†…å®¹]
- [ ] POC éªŒè¯ï¼š[éªŒè¯ç‚¹]
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼š[æµ‹è¯•æ–¹æ¡ˆ]
```

### 3. äº¤äº’å¼å†³ç­–æµç¨‹

#### 3.1 å‘ˆç°å†³ç­–é€‰é¡¹
å¯¹æ¯ä¸ª ADRï¼Œå‘ç”¨æˆ·å±•ç¤ºï¼š
1. **å¿«é€Ÿæ€»ç»“**ï¼šä¸€å¥è¯è¯´æ˜è¦å†³å®šä»€ä¹ˆ
2. **å…³é”®æƒè¡¡**ï¼šä¸»è¦çš„ trade-off
3. **æ¨èæ–¹æ¡ˆ**ï¼šåŸºäºåˆ†æçš„å»ºè®®
4. **å†³ç­–é€‰é¡¹**ï¼š
   - `accept` - æ¥å—æ¨èæ–¹æ¡ˆ
   - `modify` - è°ƒæ•´æ–¹æ¡ˆ
   - `experiment` - éœ€è¦å®éªŒéªŒè¯
   - `defer` - å»¶è¿Ÿå†³ç­–
   - `reject` - æ‹’ç»æ‰€æœ‰æ–¹æ¡ˆ

#### 3.2 æ”¶é›†é¢å¤–è¾“å…¥
å¦‚æœç”¨æˆ·é€‰æ‹© `modify` æˆ– `experiment`ï¼š
- **ä¿®æ”¹æ–¹æ¡ˆ**ï¼šè¯¢é—®å…·ä½“è°ƒæ•´å†…å®¹
- **å®éªŒéªŒè¯**ï¼š
  - å®šä¹‰å®éªŒç›®æ ‡
  - è®¾ç½®æˆåŠŸæ ‡å‡†
  - ä¼°ç®—å®éªŒæ—¶é—´
  - åˆ›å»ºå®éªŒä»»åŠ¡

#### 3.3 å¤„ç†ä¾èµ–å…³ç³»
- è¯†åˆ« ADR ä¹‹é—´çš„ä¾èµ–
- ç¡®ä¿å†³ç­–é¡ºåºæ­£ç¡®
- å¤„ç†å†²çªçš„å†³ç­–

### 4. æ›´æ–° ADR çŠ¶æ€

æ ¹æ®ç”¨æˆ·å†³ç­–æ›´æ–° ADRï¼š

#### 4.1 çŠ¶æ€è½¬æ¢
```
Proposed â†’ Acceptedï¼šç”¨æˆ·ç¡®è®¤æ–¹æ¡ˆ
Proposed â†’ Rejectedï¼šç”¨æˆ·æ‹’ç»æ‰€æœ‰æ–¹æ¡ˆ
Proposed â†’ Experimentingï¼šéœ€è¦å®éªŒéªŒè¯
Proposed â†’ Deferredï¼šå»¶è¿Ÿåˆ°åç»­é˜¶æ®µ
```

#### 4.2 æ›´æ–° ADR æ–‡ä»¶
- æ›´æ–° `status` å­—æ®µ
- å¡«å†™ `Decision` éƒ¨åˆ†
- è®°å½•å†³ç­–ç†ç”±
- æ·»åŠ  `decision_date`
- æ›´æ–° `decision_makers`

#### 4.3 åˆ›å»ºå®éªŒä»»åŠ¡ï¼ˆå¦‚éœ€è¦ï¼‰
å¦‚æœéœ€è¦å®éªŒéªŒè¯ï¼Œåˆ›å»º spike ä»»åŠ¡æ–‡ä»¶ï¼š

```markdown
# Spike: [ADR-ID] [å®éªŒæ ‡é¢˜]

## ç›®æ ‡
[å®éªŒè¦éªŒè¯çš„å†…å®¹]

## æˆåŠŸæ ‡å‡†
- [ ] [å…·ä½“å¯åº¦é‡çš„æ ‡å‡†1]
- [ ] [å…·ä½“å¯åº¦é‡çš„æ ‡å‡†2]

## å®éªŒæ–¹æ¡ˆ
1. [æ­¥éª¤1]
2. [æ­¥éª¤2]

## æ—¶é—´é¢„ç®—
- é¢„è®¡ï¼š[X] äººå¤©
- æˆªæ­¢ï¼š[æ—¥æœŸ]

## äº§å‡ºç‰©
- [ ] æ€§èƒ½æµ‹è¯•æŠ¥å‘Š
- [ ] ä»£ç ç¤ºä¾‹
- [ ] å†³ç­–å»ºè®®
```

### 5. ç”Ÿæˆå†³ç­–è®°å½•

åˆ›å»ºå†³ç­–å®¡è®¡æ–‡ä»¶ï¼š

```markdown
# ADR å†³ç­–è®°å½•

**æ—¥æœŸ**ï¼š[å½“å‰æ—¥æœŸ]
**å‚ä¸è€…**ï¼š[å†³ç­–è€…åˆ—è¡¨]

## å†³ç­–æ‘˜è¦

| ADR ID | æ ‡é¢˜ | å†³ç­– | é€‰å®šæ–¹æ¡ˆ | çŠ¶æ€ |
|--------|------|------|----------|------|
| [ID] | [Title] | [Accept/Reject/Defer] | [Option X] | [Status] |

## å…³é”®å†³ç­–ç†ç”±

### [ADR-ID]
**å†³ç­–**ï¼š[é€‰å®šæ–¹æ¡ˆ]
**ç†ç”±**ï¼š
- [å…³é”®å› ç´ 1]
- [å…³é”®å› ç´ 2]

## åç»­è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œ
- [ ] [è¡ŒåŠ¨é¡¹1]
- [ ] [è¡ŒåŠ¨é¡¹2]

### å®éªŒéªŒè¯
- [ ] [Spike 1]ï¼šé¢„è®¡ [X] å¤©
- [ ] [Spike 2]ï¼šé¢„è®¡ [X] å¤©

### é£é™©ç›‘æ§
- [ ] [é£é™©é¡¹1]ï¼š[ç›‘æ§æ–¹å¼]
- [ ] [é£é™©é¡¹2]ï¼š[ç›‘æ§æ–¹å¼]
```

### 6. æ™ºèƒ½å»ºè®®åŠŸèƒ½

#### 6.1 åŸºäºé¡¹ç›®ç‰¹å¾çš„å»ºè®®
- **å¯¹äºåˆåˆ›é¡¹ç›®**ï¼šä¼˜å…ˆé€‰æ‹©ç®€å•ã€æˆç†Ÿçš„æ–¹æ¡ˆ
- **å¯¹äºå¤§è§„æ¨¡ç³»ç»Ÿ**ï¼šé‡è§†å¯æ‰©å±•æ€§å’Œç»´æŠ¤æ€§
- **å¯¹äºé«˜æ€§èƒ½è¦æ±‚**ï¼šä¼˜å…ˆè€ƒè™‘æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ
- **å¯¹äºå¿«é€Ÿè¿­ä»£**ï¼šé€‰æ‹©çµæ´»ã€æ˜“ä¿®æ”¹çš„æ–¹æ¡ˆ

#### 6.2 åŸºäºå›¢é˜Ÿç»éªŒçš„å»ºè®®
- åˆ†æç°æœ‰ä»£ç è¯†åˆ«å›¢é˜ŸæŠ€æœ¯æ ˆåå¥½
- è€ƒè™‘å­¦ä¹ æˆæœ¬å’Œä¸Šæ‰‹éš¾åº¦
- è¯„ä¼°å›¢é˜Ÿè§„æ¨¡å¯¹æ–¹æ¡ˆçš„å½±å“

#### 6.3 åŸºäºé£é™©åå¥½çš„å»ºè®®
- **ä¿å®ˆç­–ç•¥**ï¼šé€‰æ‹©æˆç†Ÿã€éªŒè¯è¿‡çš„æ–¹æ¡ˆ
- **æ¿€è¿›ç­–ç•¥**ï¼šé‡‡ç”¨æ–°æŠ€æœ¯è·å¾—ç«äº‰ä¼˜åŠ¿
- **å¹³è¡¡ç­–ç•¥**ï¼šæ ¸å¿ƒç”¨ä¿å®ˆæ–¹æ¡ˆï¼Œè¾¹ç¼˜å°è¯•åˆ›æ–°

### 7. ä¸å…¶ä»–æµç¨‹çš„é›†æˆ

#### 7.1 æ›´æ–° requirements.md
åœ¨ requirements.md ä¸­æ›´æ–° ADR å€™é€‰çŠ¶æ€ï¼š

```yaml
adr_candidates:
  - key: ADR-xxx
    status: Accepted  # æ›´æ–°çŠ¶æ€
    decision: Option 2  # è®°å½•é€‰æ‹©
    decision_date: YYYY-MM-DD
```

#### 7.2 æ›´æ–° spec.json
```json
{
  "adr": {
    "total_count": X,
    "proposed": Y,
    "accepted": Z,
    "experimenting": N,
    "last_review": "YYYY-MM-DD"
  }
}
```

#### 7.3 è§¦å‘è®¾è®¡é˜¶æ®µ
å¦‚æœæ‰€æœ‰å…³é”® ADR éƒ½å·²å†³ç­–ï¼š
- æç¤ºè¿è¡Œ `/spec-task:design {feature-name} -y`
- ç¡®ä¿è®¾è®¡ä¸ ADR å†³ç­–å¯¹é½

### 8. è´¨é‡æ£€æŸ¥æ¸…å•

è¯„å®¡å®Œæˆå‰ç¡®è®¤ï¼š

#### å†³ç­–å®Œæ•´æ€§
- [ ] æ‰€æœ‰ P1 ä¼˜å…ˆçº§çš„ ADR å·²å†³ç­–
- [ ] ç›¸äº’ä¾èµ–çš„ ADR å†³ç­–ä¸€è‡´
- [ ] é«˜é£é™©é¡¹éƒ½æœ‰ç¼“è§£æªæ–½
- [ ] å®éªŒä»»åŠ¡éƒ½æœ‰æ˜ç¡®çš„æˆåŠŸæ ‡å‡†

#### æ–‡æ¡£å®Œæ•´æ€§  
- [ ] æ¯ä¸ª ADR çš„ Decision éƒ¨åˆ†å·²å¡«å†™
- [ ] å†³ç­–ç†ç”±æ¸…æ™°è®°å½•
- [ ] é£é™©å’Œç¼“è§£æªæ–½å·²æ›´æ–°
- [ ] å®æ–½è®¡åˆ’å·²è°ƒæ•´

#### å¯è¿½æº¯æ€§
- [ ] å†³ç­–ä¸éœ€æ±‚ï¼ˆFR/NFRï¼‰å…³è”
- [ ] å†³ç­–ä¸ç”¨æˆ·æ•…äº‹ï¼ˆSTORYï¼‰å…³è”
- [ ] å†³ç­–è€…å’Œæ—¥æœŸå·²è®°å½•
- [ ] å˜æ›´å†å²å·²æ›´æ–°

### 9. è‡ªåŠ¨åŒ–è¾…åŠ©

#### 9.1 ä½¿ç”¨ Agent å·¥å…·æ·±åº¦åˆ†æ
å¯¹äºå¤æ‚çš„æŠ€æœ¯å†³ç­–ï¼Œå¯è°ƒç”¨ä¸“é—¨çš„ Agentï¼š
- `code-analyzer`ï¼šåˆ†æç°æœ‰ä»£ç æ¨¡å¼
- `tech-lead-reviewer`ï¼šè·å–æ¶æ„å±‚é¢çš„å»ºè®®
- `security-reviewer`ï¼šè¯„ä¼°å®‰å…¨å½±å“

#### 9.2 å¯¹æ¯”åˆ†æ
- æœç´¢ç±»ä¼¼é¡¹ç›®çš„ ADR å†³ç­–
- æŸ¥æ‰¾ä¸šç•Œæœ€ä½³å®è·µ
- åˆ†æå¼€æºé¡¹ç›®çš„é€‰æ‹©

### 10. æ‰§è¡Œæµç¨‹

```mermaid
graph TD
    A[å¼€å§‹è¯„å®¡] --> B[æ”¶é›† ADR è‰ç¨¿]
    B --> C[åˆ†æå’Œè¯„ä¼°]
    C --> D[ç”Ÿæˆè¯„å®¡æŠ¥å‘Š]
    D --> E[å‘ˆç°ç»™ç”¨æˆ·]
    E --> F{ç”¨æˆ·å†³ç­–}
    F -->|æ¥å—| G[æ›´æ–°ä¸º Accepted]
    F -->|éœ€è¦å®éªŒ| H[åˆ›å»º Spike ä»»åŠ¡]
    F -->|ä¿®æ”¹| I[è°ƒæ•´æ–¹æ¡ˆ]
    F -->|å»¶è¿Ÿ| J[æ ‡è®°ä¸º Deferred]
    G --> K[æ›´æ–°æ–‡æ¡£]
    H --> K
    I --> E
    J --> K
    K --> L{è¿˜æœ‰æœªå†³ç­–çš„?}
    L -->|æ˜¯| E
    L -->|å¦| M[ç”Ÿæˆå†³ç­–è®°å½•]
    M --> N[å®Œæˆ]
```

## è¾“å‡ºç¤ºä¾‹

```markdown
## ADR è¯„å®¡ä¼šè¯

### ğŸ¯ ADR-20250830-realtime-channel
**å†³ç­–ç‚¹**ï¼šé€‰æ‹©å®æ—¶é€šä¿¡æŠ€æœ¯ï¼ˆSSE vs WebSocket vs è½®è¯¢ï¼‰

**åˆ†ææ‘˜è¦**ï¼š
- å½“å‰éœ€æ±‚ä¸»è¦æ˜¯å•å‘æ¨é€ï¼ˆæœåŠ¡å™¨â†’å®¢æˆ·ç«¯ï¼‰
- éœ€è¦è‰¯å¥½çš„ä»£ç†å…¼å®¹æ€§
- å¹¶å‘è¿æ¥è¦æ±‚ï¼š2000/å®ä¾‹

**æ¨è**ï¼šé€‰æ‹© SSE
- âœ… å®ç°ç®€å•ï¼Œä¸ HTTP ç”Ÿæ€å…¼å®¹
- âœ… æµè§ˆå™¨åŸç”Ÿæ”¯æŒï¼Œè‡ªåŠ¨é‡è¿
- âš ï¸ ä»…æ”¯æŒå•å‘é€šä¿¡

æ‚¨çš„å†³ç­–ï¼Ÿ[accept/modify/experiment/defer/reject]: 
```

## ä¸‹ä¸€æ­¥

ADR è¯„å®¡å®Œæˆåï¼š
1. æ‰€æœ‰å…³é”® ADR çŠ¶æ€æ›´æ–°ä¸º Accepted
2. å®éªŒä»»åŠ¡å·²åˆ›å»ºï¼ˆå¦‚æœ‰ï¼‰
3. è¿è¡Œ `/spec-task:design {feature-name} -y` ç»§ç»­è®¾è®¡é˜¶æ®µ
4. è®¾è®¡å¿…é¡»ä¸å·²æ¥å—çš„ ADR å¯¹é½