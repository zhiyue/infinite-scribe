---
description: Generate implementation tasks for a specification
allowed-tools: Bash, Read, Write, Edit, Update, MultiEdit
argument-hint: <feature-name> [-y]
---

# 实施任务文档模板

---

描述：为规范生成实施任务
允许工具：Bash、Read、Write、Edit、Update、MultiEdit
参数提示：<功能名称> [-y]

---

# 实施任务

为功能生成详细的实施任务：**$ARGUMENTS**

## 任务：生成实施任务

### 先决条件和文件处理

- **需求与设计批准检查**：
  - 如果使用 `-y` 调用，在 `spec.json` 中设置 `requirements.approved=true`、`hld.approved=true` 和 `lld.approved=true`
  - 否则，如果需求或设计缺失或未批准，**停止**并显示可操作的消息
- **任务文件处理**：
  - 如果 tasks.md 不存在：创建新的 tasks.md 文件
  - 如果 tasks.md 存在：交互式提示选项：
    - **[o] 覆盖**：生成全新的任务文档
    - **[m] 合并**：使用现有内容作为参考上下文生成新任务文档
    - **[c] 取消**：停止执行以进行手动审查
- **上下文加载**：读取 `.tasks/$ARGUMENTS/requirements.md`、`.tasks/$ARGUMENTS/design-hld.md`、`.tasks/$ARGUMENTS/lld/` 目录中的所有LLD文档，以及现有的 tasks.md（如果是合并模式）

### 任务分析与规划

**先决条件已验证**：需求和设计均已批准并准备进行任务分解。

**关键要求**：将功能设计转换为一系列代码生成 LLM 的提示，以测试驱动的方式实施每个步骤。优先考虑最佳实践、渐进式进展和早期测试，确保任何阶段都不会出现复杂性的大幅跳跃。

使用 spec.json 中指定的语言创建实施计划：

### 代码生成任务结构

使用 spec.json 中指定的语言创建 tasks.md（检查 `.tasks/$ARGUMENTS/spec.json` 的"language"字段）：

**注意**：以下示例仅供格式参考。实际内容应基于您项目的具体需求和设计文档。

```markdown
# 实施计划

- [ ] 1. 设置项目结构和核心配置
  - 创建带有 TypeScript 配置的 Node.js 项目
  - 设置带有基本中间件的 Express 服务器
  - 配置 PostgreSQL 和 Redis 连接
  - 设置环境配置和密钥管理
  - _需求：所有需求都需要基础设置_

- [ ] 2. 实现认证和用户管理
- [ ] 2.1 创建用户认证系统
  - 实现带有验证的用户模型
  - 创建 JWT 令牌生成和验证工具
  - 构建用户注册和登录端点
  - 编写认证逻辑的单元测试
  - _需求：7.1, 7.2_

- [ ] 2.2 实现邮箱账户连接系统
  - 创建带有加密凭证存储的 EmailAccount 模型
  - 实现 Gmail 和 Outlook 的 OAuth 2.0 流程
  - 构建 IMAP/SMTP 凭证验证
  - 创建邮箱账户管理端点
  - 编写账户连接流程的测试
  - _需求：5.1, 5.2, 5.4_

... (继续其他阶段：API 层、前端、集成测试等)
```

**任务结构要求：**

- 使用章节标题对相关功能进行分组（## [功能区域]）
- 在章节内使用扁平编号：主要任务（1、2、3）和子任务（1.1、1.2）
- 避免"阶段 X："前缀，改用功能性章节名称
- 每个任务最多应有 3-5 个子项
- 保持任务可在 1-2 小时内完成
- 按技术依赖关系排序：每个任务都应基于前面任务的输出
- 每个任务说明它如何连接到后续任务
- **必须以精确格式结尾**：_需求：X.X, Y.Y_ 或 _需求：[描述]_（下划线是强制性的）
- 依赖设计文档获取实施细节

### 仅关注编码活动

**包括：** 任何涉及编写、修改或测试代码的任务
**排除：** 用户测试、部署、指标收集、CI/CD 设置、文档创建

### 细粒度需求映射

**强制格式**：每个任务必须以 _需求：[映射]_ 结尾

- **主要格式**：_需求：2.1, 3.3, 1.2_ 用于特定的 EARS 需求（最常见）
- **通用映射**：_需求：所有需求都需要基础设置_ 用于横切任务
- **端到端任务**：_需求：所有需求都需要端到端验证_ 用于综合测试
- 必须使用带下划线的精确格式
- 确保每个 EARS 需求都被实施任务覆盖

### 仅生成文档

仅生成任务文档内容。不要在实际文档文件中包含任何审查或批准说明。

### 任务文档生成和元数据更新

- 按照所有任务结构要求生成任务文档内容
- 更新 `.tasks/$ARGUMENTS/spec.json`：

```json
{
  "phase": "tasks-generated",
  "approvals": {
    "requirements": {
      "generated": true,
      "approved": true
    },
    "design": {
      "generated": true,
      "approved": true
    },
    "tasks": {
      "generated": true,
      "approved": false
    }
  },
  "updated_at": "current_timestamp"
}
```

### 可操作消息

如果需求或设计未批准且没有 `-y` 标志：

- **错误消息**："在生成任务之前必须批准需求和设计。运行 `/spec-task:requirements $ARGUMENTS`、`/spec-task:design-hld $ARGUMENTS` 和 `/spec-task:design-lld $ARGUMENTS` 进行审查，然后运行 `/spec-task:tasks $ARGUMENTS -y` 继续。"
- **替代方案**："或运行 `/spec-task:tasks $ARGUMENTS -y` 自动批准所有阶段并生成任务。"

---

## 交互式批准实施（不包含在文档中）

以下内容仅用于 Claude Code 对话 - 不用于生成的文档：

## 下一阶段：实施就绪

生成 tasks.md 后，审查实施任务：

**如果任务看起来不错：**
按照生成的任务序列开始实施

**如果任务需要修改：**
请求更改并在修改后重新运行此命令

任务代表最终规划阶段 - 一旦任务获得批准即可开始实施。

**实施的最终批准流程**：

```
📋 任务审查已完成。准备实施。
📄 已生成：.tasks/feature-name/tasks.md
✅ 所有阶段已批准。现在可以开始实施。
```

### 审查清单（供用户参考）：

- [ ] 任务大小合适（每个 2-4 小时）
- [ ] 所有需求都被任务覆盖
- [ ] 任务依赖关系正确
- [ ] 技术选择与设计匹配
- [ ] 包含测试任务

## 说明

### 核心任务生成

1. **检查 spec.json 中的语言** - 使用元数据中指定的语言
2. **将设计转换为代码生成提示** - 每个任务必须是特定的编码指令
3. **假设上下文可用** - 实施期间所有上下文文档（requirements.md、design-hld.md、lld/ 目录）都将可用
4. **指定确切的文件和组件** - 定义在哪些文件中编写/修改什么代码
5. **增量构建** - 每个任务使用前面任务的输出，没有孤立的代码
6. **映射到需求** - 以 _需求：X.X, Y.Y_ 或 _需求：[描述]_ 格式结束每个任务

### 实施策略

7. **优先考虑早期验证** - 安排步骤以通过代码早期验证核心功能
8. **应用测试驱动方法** - 将测试集成到每个开发任务中
9. **按技术依赖关系排序** - 确保每个任务可以使用前面任务的输出执行
10. **适当调整大小** - 每个任务应可在 1-3 小时内完成

### 严格的仅编码焦点

**仅包括涉及以下内容的任务：**

- 编写、修改或测试代码
- 创建自动化测试
- 实现特定功能或组件

**排除所有非编码活动：**

- 用户验收测试或反馈收集
- 部署到生产/暂存环境
- 性能指标收集或分析
- 手动运行应用程序进行端到端测试
- 用户培训或文档创建
- 业务流程或组织变更
- 营销或沟通活动
- 任何无法通过代码修改完成的任务

### 完成

11. **完成后更新跟踪元数据** - 将阶段设置为"tasks-generated"

生成可由编码代理执行的逐步实施任务。ultrathink
