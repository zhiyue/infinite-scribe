---
name: AI Service Integration for Real-time Streaming
status: open
created: 2025-08-28T12:52:35Z
updated: 2025-08-28T12:52:35Z
github: [Will be updated when synced to GitHub]
depends_on: [001, 003]
parallel: false
conflicts_with: []
---

# Task: AI Service Integration for Real-time Streaming

## Description

Integrate existing AI generation services with SSE infrastructure to enable real-time content streaming and progress notifications. Implement callback mechanisms for AI services to publish streaming events during "创世阶段" operations and content generation processes.

## Acceptance Criteria

- [ ] AI generation services emit streaming events for real-time text generation
- [ ] Progress callbacks integrated for multi-stage "创世阶段" operations
- [ ] Generation interruption and resumption capabilities through SSE events
- [ ] Error handling for AI service failures with proper SSE error events
- [ ] Content streaming supports partial updates with position tracking
- [ ] Stage completion notifications with results preview
- [ ] Generation context maintained across streaming sessions
- [ ] Dynamic progress estimation based on operation complexity

## Technical Details

### Implementation Approach
- **Service Integration**: Extend existing AI services with SSE event publishing
- **Progress Callbacks**: Multi-stage operation reporting with detailed status
- **Streaming Protocol**: Chunked content delivery with position markers
- **Error Recovery**: Graceful handling of AI service interruptions

### Code Locations/Files Affected
- `apps/backend/src/sse/ai_integration.py` - AI service callback integration
- Update existing AI service classes to emit SSE events:
  - `apps/backend/src/ai/generation/` - Content generation services
  - `apps/backend/src/ai/genesis/` - "创世阶段" world-building services
- `apps/backend/src/sse/ai_events.py` - AI-specific event types and schemas
- Update `apps/backend/src/ai/base.py` - Base AI service with SSE support

### Key Considerations
- **Non-blocking Integration**: SSE events shouldn't slow down AI processing
- **Backward Compatibility**: Existing AI services continue working without SSE
- **Content Chunking**: Efficient streaming of large AI-generated content
- **State Management**: Track generation state for interruption/resumption

## Dependencies

- [ ] Task 001 - Backend SSE Infrastructure (event system required)
- [ ] Task 003 - Event Persistence (critical for AI completion events)
- [ ] Existing AI generation services and interfaces
- [ ] AI service progress tracking capabilities

## Effort Estimate

- **Size**: L (Large - requires AI service modifications)
- **Hours**: 14-18 hours
- **Parallel**: false (depends on SSE infrastructure and persistence)

## Definition of Done

- [ ] AI text streams in real-time during generation
- [ ] "创世阶段" operations show detailed progress updates
- [ ] Generation can be interrupted and resumed through SSE
- [ ] AI service errors properly communicated via SSE events
- [ ] Content streaming maintains correct positioning and context
- [ ] Stage completion events include meaningful progress information
- [ ] Integration tests verify AI-SSE event flow
- [ ] Performance impact on AI services is minimal (<5% overhead)