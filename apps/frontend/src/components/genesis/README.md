# 创世组件设计文档

## 组件架构

### 1. 核心组件

#### GenesisNavigation（创世导航）
- **功能**: 展示创世流程的各个阶段，支持阶段切换和进度显示
- **特性**:
  - 阶段状态管理（pending、active、completed、locked）
  - 进度条显示
  - 阶段切换交互
  - 视觉反馈（动画、颜色）

#### GenesisStageContent（阶段内容）
- **功能**: 根据不同阶段展示相应的内容和操作界面
- **包含阶段**:
  - 初始灵感（INITIAL_PROMPT）
  - 世界观设定（WORLDVIEW）
  - 角色塑造（CHARACTERS）
  - 剧情大纲（PLOT_OUTLINE）
  - 创世完成（FINISHED）

#### GenesisPage（创世页面）
- **功能**: 管理整个创世流程
- **特性**:
  - 会话管理
  - 阶段状态同步
  - 左右布局（导航+内容）

### 2. 布局设计

```
┌─────────────────────────────────────────────┐
│                  创世设定                     │
├─────────────────────────────────────────────┤
│                                             │
│  ┌──────────┬────────────────────────────┐  │
│  │          │                            │  │
│  │  导航栏   │        内容区域            │  │
│  │          │                            │  │
│  │ ▶ 初始灵感 │   ┌─────────────────┐    │  │
│  │ ▶ 世界观  │   │                 │    │  │
│  │ ▶ 角色   │   │   阶段内容表单    │    │  │
│  │ ▶ 剧情   │   │                 │    │  │
│  │ ✓ 完成   │   └─────────────────┘    │  │
│  │          │                            │  │
│  └──────────┴────────────────────────────┘  │
│                                             │
└─────────────────────────────────────────────┘
```

### 3. 交互流程

1. **初始化**
   - 用户进入创世页面
   - 系统创建或恢复会话
   - 显示当前阶段

2. **阶段导航**
   - 点击已完成阶段：可以返回查看/修改
   - 点击当前阶段：展示当前内容
   - 点击锁定阶段：显示提示信息

3. **内容编辑**
   - 填写表单内容
   - AI辅助生成
   - 保存并进入下一阶段

4. **完成流程**
   - 所有阶段完成
   - 生成小说基础设定
   - 可以开始写作

### 4. 与对话API集成

```typescript
// 创建创世会话
const session = await createSession({
  scope_type: 'GENESIS',
  scope_id: novelId,
  stage: 'INITIAL_PROMPT'
})

// 发送阶段内容
const round = await sendMessage(sessionId, {
  input: {
    stage: 'WORLDVIEW',
    content: worldviewData
  }
})

// 切换阶段
await setStage(sessionId, {
  stage: 'CHARACTERS'
})
```

### 5. 状态管理

- **会话状态**: 使用 Conversation API 管理
- **本地状态**: 使用 React State 管理表单
- **缓存策略**: 使用 TanStack Query 缓存

### 6. UI/UX 设计原则

1. **清晰的流程指引**
   - 进度条显示整体进度
   - 阶段状态明确（图标、颜色）
   - 操作提示和帮助信息

2. **流畅的交互体验**
   - 平滑的阶段切换动画
   - 实时保存提示
   - 加载状态反馈

3. **AI辅助功能**
   - 智能建议
   - 内容生成
   - 优化提示

4. **响应式设计**
   - 移动端适配
   - 大屏优化
   - 自适应布局

### 7. 技术栈

- **框架**: React + TypeScript
- **UI库**: Shadcn UI + Tailwind CSS
- **状态管理**: TanStack Query + Zustand
- **API集成**: Conversation Service
- **图标**: Lucide Icons

### 8. 未来扩展

1. **模板系统**
   - 预设创世模板
   - 自定义模板
   - 模板分享

2. **协作功能**
   - 多人创世
   - 评论系统
   - 版本对比

3. **AI增强**
   - 更智能的内容生成
   - 风格一致性检查
   - 逻辑冲突检测

4. **导出功能**
   - 导出为文档
   - 生成思维导图
   - 分享链接