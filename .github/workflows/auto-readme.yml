name: Auto Generate README

on:
  push:
    paths:
      - '**/*.py'
      - '**/*.ts'
      - '**/*.tsx'
      - '**/*.js'
      - '**/*.jsx'
      - '!**/test/**'
      - '!**/tests/**'
      - '!**/__tests__/**'
      - '!**/spec/**'
      - '!**/*.test.*'
      - '!**/*.spec.*'
  pull_request:
    paths:
      - '**/*.py'
      - '**/*.ts'
      - '**/*.tsx'
      - '**/*.js'
      - '**/*.jsx'
      - '!**/test/**'
      - '!**/tests/**'
      - '!**/__tests__/**'
      - '!**/spec/**'
      - '!**/*.test.*'
      - '!**/*.spec.*'

jobs:
  auto-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write # ç›´æ¥æäº¤ README æ–‡ä»¶åˆ°å½“å‰åˆ†æ”¯
      actions: read # Claude action éœ€è¦è¯»å– CI ä¿¡æ¯
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Auto Generate README
        uses: anthropics/claude-code-base-action@beta
        with:
          prompt: |
            REPO: ${{ github.repository }}
            BRANCH: ${{ github.ref_name }}

            ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ€æœ¯æ–‡æ¡£ç”ŸæˆåŠ©æ‰‹ã€‚è¯·æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š

            ## ğŸ“‹ ä»»åŠ¡ç›®æ ‡
            **ä¸¥æ ¼è¦æ±‚**ï¼šä»…ä¸ºæœ€è¿‘ä¸€æ¬¡æäº¤ï¼ˆHEADï¼‰ä¸­æœ‰ä»£ç å˜æ›´çš„å­ç›®å½•è‡ªåŠ¨ç”Ÿæˆé«˜è´¨é‡çš„ä¸­æ–‡ README.md æ–‡ä»¶

            ## ğŸ” åˆ†ææ­¥éª¤
            1. **ä¸¥æ ¼é™å®šå˜æ›´èŒƒå›´**
               - **å¿…é¡»ä½¿ç”¨ `git diff HEAD~1 HEAD --name-only` è·å–æœ€è¿‘ä¸€æ¬¡æäº¤çš„å˜æ›´æ–‡ä»¶**
               - **ä»…åˆ†æè¿™äº›å˜æ›´æ–‡ä»¶**
               - ä»å˜æ›´æ–‡ä»¶åˆ—è¡¨ä¸­è¯†åˆ«åŒ…å«ä»£ç æ–‡ä»¶çš„å­ç›®å½•ï¼ˆ.py, .ts, .tsx, .js, .jsx ç­‰ï¼‰
               - **æ’é™¤æµ‹è¯•ç›®å½•**ï¼šè·³è¿‡ test/ã€tests/ã€__tests__/ã€spec/ ç­‰æµ‹è¯•æ–‡ä»¶å¤¹
               - è¿‡æ»¤æ‰é…ç½®æ–‡ä»¶ã€æ–‡æ¡£ç­‰éæ ¸å¿ƒä»£ç ç›®å½•

            2. **é™å®šç›®å½•ç»“æ„åˆ†æ**
               - **ä»…è¯»å–å˜æ›´æ¶‰åŠçš„å­ç›®å½•çš„æ–‡ä»¶ç»“æ„**
               - **ç¦æ­¢åˆ†ææœªåœ¨æœ€è¿‘æäº¤ä¸­å˜æ›´çš„ç›®å½•**
               - è¯†åˆ«å…³é”®é…ç½®æ–‡ä»¶ï¼ˆpackage.json, requirements.txt ç­‰ï¼‰
               - ä»…åˆ†æå˜æ›´çš„ä»£ç æ–‡ä»¶ï¼Œæ¨æ–­æ¨¡å—åŠŸèƒ½å’Œæ¶æ„

            3. **README å†…å®¹ç”Ÿæˆ**
               - **ä»…ä¸ºæœ‰å˜æ›´çš„å­ç›®å½•ç”Ÿæˆ/æ›´æ–° README**
               - é¡¹ç›®/æ¨¡å—ç®€ä»‹å’Œæ ¸å¿ƒåŠŸèƒ½
               - ç›®å½•ç»“æ„è¯´æ˜
               - **å¯è§†åŒ–å›¾è¡¨**ï¼šä½¿ç”¨ mermaid ç”Ÿæˆç›¸å…³å›¾è¡¨æå‡ç†è§£
               - å®‰è£…å’Œä½¿ç”¨æ–¹æ³•
               - API æ–‡æ¡£ï¼ˆå¦‚æœæ˜¯æœåŠ¡/åº“ï¼‰
               - å¼€å‘æŒ‡å—å’Œè´¡çŒ®è¯´æ˜

            ## ğŸ“ å†…å®¹è¦æ±‚
            - **è¯­è¨€**: ä½¿ç”¨ä¸­æ–‡ç¼–å†™
            - **é£æ ¼**: ç®€æ´å®ç”¨ï¼Œé‡ç‚¹çªå‡º
            - **ç»“æ„**: æ¸…æ™°çš„å±‚æ¬¡å’Œæ ¼å¼
            - **å¯è§†åŒ–å›¾è¡¨**ï¼ˆä½¿ç”¨ mermaid è¯­æ³•ï¼‰:
              * **æµç¨‹å›¾**: æ ¸å¿ƒä¸šåŠ¡æµç¨‹ã€æ•°æ®å¤„ç†æµç¨‹
              * **æ—¶åºå›¾**: API è°ƒç”¨åºåˆ—ã€ç»„ä»¶äº¤äº’æ—¶åº
              * **ç±»å›¾**: æ•°æ®æ¨¡å‹å…³ç³»ã€ç»„ä»¶ç»§æ‰¿ç»“æ„
              * **æ¶æ„å›¾**: æ¨¡å—ä¾èµ–å…³ç³»ã€ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ
              * **çŠ¶æ€å›¾**: ä¸šåŠ¡çŠ¶æ€è½¬æ¢ã€ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
            - **é’ˆå¯¹æ€§**:
              * å‰ç«¯ç›®å½•ï¼šç»„ä»¶å…³ç³»å›¾ã€é¡µé¢è·¯ç”±å›¾ã€çŠ¶æ€æµè½¬å›¾
              * åç«¯ç›®å½•ï¼šAPI æ—¶åºå›¾ã€æ•°æ®æµç¨‹å›¾ã€æœåŠ¡æ¶æ„å›¾
              * å·¥å…·ç›®å½•ï¼šä½¿ç”¨æµç¨‹å›¾ã€é…ç½®å…³ç³»å›¾

            ## ğŸ”„ æ›´æ–°ç­–ç•¥
            - **ä»…æ›´æ–°æœ‰ä»£ç å˜æ›´çš„ç›®å½•çš„ README.md**
            - å¦‚æœç›®å½•å·²æœ‰ README.mdï¼Œæ™ºèƒ½æ›´æ–°è€Œä¸æ˜¯å®Œå…¨è¦†ç›–
            - ä¿ç•™ç”¨æˆ·è‡ªå®šä¹‰çš„é‡è¦å†…å®¹
            - å¢å¼ºå’Œè¡¥å……ç¼ºå¤±çš„æ ‡å‡†ä¿¡æ¯

            ## âš ï¸ ä¸¥æ ¼é™åˆ¶
            - **ç¦æ­¢åˆ†ææˆ–ä¿®æ”¹æœªåœ¨æœ€è¿‘æäº¤ä¸­å˜æ›´çš„ç›®å½•**
            - **ç¦æ­¢ç”Ÿæˆæˆ–æ›´æ–°æœªå˜æ›´ç›®å½•çš„ README æ–‡ä»¶**
            - **å¿…é¡»ä¸¥æ ¼æŒ‰ç…§ git diff ç»“æœç¡®å®šå·¥ä½œèŒƒå›´**

            ## ğŸ“¦ é¡¹ç›®ä¸Šä¸‹æ–‡
            **InfiniteScribe** - AI é©±åŠ¨çš„å°è¯´å†™ä½œå¹³å°
            - åç«¯ï¼šPython 3.11 + FastAPI + SQLAlchemy
            - å‰ç«¯ï¼šReact 18 + TypeScript + Vite
            - æ¶æ„ï¼šå¾®æœåŠ¡ + äº‹ä»¶é©±åŠ¨

            ## ğŸ¨ Mermaid å›¾è¡¨æŒ‡å—
            - **è¯­æ³•è§„èŒƒ**: ä½¿ç”¨æ ‡å‡† mermaid è¯­æ³•ï¼Œç¡®ä¿ GitHub å¯æ­£å¸¸æ¸²æŸ“
            - **å›¾è¡¨é€‰æ‹©**: æ ¹æ®ä»£ç å¤æ‚åº¦å’Œä¸šåŠ¡é€»è¾‘é€‰æ‹©åˆé€‚çš„å›¾è¡¨ç±»å‹
            - **èŠ‚ç‚¹å‘½å**: ä½¿ç”¨ä¸­æ–‡æè¿°ï¼Œç®€æ´æ˜äº†
            - **é¢œè‰²ä¸»é¢˜**: å¯ä½¿ç”¨ mermaid ä¸»é¢˜å¢å¼ºè§†è§‰æ•ˆæœ
            - **å›¾è¡¨å¤§å°**: æ§åˆ¶å¤æ‚åº¦ï¼Œé¿å…è¿‡äºå¤æ‚çš„å›¾è¡¨
            - **å®ç”¨æ€§**: é‡ç‚¹çªå‡ºå…³é”®æµç¨‹å’Œæ ¸å¿ƒæ¶æ„ï¼Œé¿å…ç»˜åˆ¶çç¢ç»†èŠ‚

            **ç¤ºä¾‹æ ¼å¼**:
            ```mermaid
            graph TD
                A[ç”¨æˆ·è¯·æ±‚] --> B{éªŒè¯æƒé™}
                B -->|é€šè¿‡| C[å¤„ç†ä¸šåŠ¡é€»è¾‘]
                B -->|å¤±è´¥| D[è¿”å›é”™è¯¯]
                C --> E[è¿”å›ç»“æœ]
            ```

            ## âœ… å®Œæˆæ“ä½œ
            ä½¿ç”¨ä»¥ä¸‹æ­¥éª¤æäº¤ç”Ÿæˆçš„ README æ–‡ä»¶ï¼š
            1. `git add` æ·»åŠ ç”Ÿæˆ/ä¿®æ”¹çš„ README æ–‡ä»¶
            2. `git commit` æäº¤ï¼Œæ¶ˆæ¯æ ¼å¼ï¼š`docs: auto-generate README files for changed directories [æœ€è¿‘æäº¤å“ˆå¸Œå‰7ä½]`
            3. `gh push` æ¨é€åˆ°å½“å‰åˆ†æ”¯

          anthropic_api_key: ${{ secrets.GLM_API_KEY }}
          allowed_tools: 'Bash(git:*),View,GlobTool,GrepTool,BatchTool,Write,Edit,MultiEdit,Bash(gh push:*),Bash(gh:*)'
          model: ${{ vars.GLM_MODEL }}
          claude_env: |
            ANTHROPIC_BASE_URL: ${{ vars.GLM_BASE_URL }}
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GIT_USER_NAME: github-actions[bot]
          GIT_USER_EMAIL: 41898282+github-actions[bot]@users.noreply.github.com
