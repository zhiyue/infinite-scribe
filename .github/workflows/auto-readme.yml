name: Auto Generate README

on:
  push:
    paths:
      - '**/*.py'
      - '**/*.ts'
      - '**/*.tsx'
      - '**/*.js'
      - '**/*.jsx'
      - '!**/test/**'
      - '!**/tests/**'
      - '!**/__tests__/**'
      - '!**/spec/**'
      - '!**/*.test.*'
      - '!**/*.spec.*'
  pull_request:
    paths:
      - '**/*.py'
      - '**/*.ts'
      - '**/*.tsx'
      - '**/*.js'
      - '**/*.jsx'
      - '!**/test/**'
      - '!**/tests/**'
      - '!**/__tests__/**'
      - '!**/spec/**'
      - '!**/*.test.*'
      - '!**/*.spec.*'

jobs:
  auto-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write # ç›´æŽ¥æäº¤ README æ–‡ä»¶åˆ°å½“å‰åˆ†æ”¯
      actions: read # Claude action éœ€è¦è¯»å– CI ä¿¡æ¯
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Auto Generate README with Progress Tracking
        uses: anthropics/claude-code-base-action@v1
        with:
          anthropic_api_key: ${{ secrets.GLM_API_KEY }}

          # è‡ªå®šä¹‰ README ç”Ÿæˆæç¤ºè¯
          prompt: |
            REPO: ${{ github.repository }}
            BRANCH: ${{ github.ref_name }}

            ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ€æœ¯æ–‡æ¡£ç”ŸæˆåŠ©æ‰‹ã€‚è¯·æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š

            ## ðŸ“‹ ä»»åŠ¡ç›®æ ‡
            ä¸ºæœ‰ä»£ç å˜æ›´çš„å­ç›®å½•è‡ªåŠ¨ç”Ÿæˆé«˜è´¨é‡çš„ä¸­æ–‡ README.md æ–‡ä»¶

            ## ðŸ” åˆ†æžæ­¥éª¤
            1. **æ£€æµ‹å˜æ›´ç›®å½•**
               - åˆ†æžå½“å‰ä»£ç å˜æ›´ä¸­åŒ…å«çš„æ–‡ä»¶
               - è¯†åˆ«åŒ…å«ä»£ç æ–‡ä»¶çš„å­ç›®å½•ï¼ˆ.py, .ts, .tsx, .js, .jsx ç­‰ï¼‰
               - **æŽ’é™¤æµ‹è¯•ç›®å½•**ï¼šè·³è¿‡ test/ã€tests/ã€__tests__/ã€spec/ ç­‰æµ‹è¯•æ–‡ä»¶å¤¹
               - è¿‡æ»¤æŽ‰é…ç½®æ–‡ä»¶ã€æ–‡æ¡£ç­‰éžæ ¸å¿ƒä»£ç ç›®å½•

            2. **ç›®å½•ç»“æž„åˆ†æž**
               - è¯»å–æ¯ä¸ªç›®å½•çš„æ–‡ä»¶ç»“æž„
               - è¯†åˆ«å…³é”®é…ç½®æ–‡ä»¶ï¼ˆpackage.json, requirements.txt ç­‰ï¼‰
               - åˆ†æžä»£ç æ–‡ä»¶ï¼ŒæŽ¨æ–­æ¨¡å—åŠŸèƒ½å’Œæž¶æž„

            3. **README å†…å®¹ç”Ÿæˆ**
               - é¡¹ç›®/æ¨¡å—ç®€ä»‹å’Œæ ¸å¿ƒåŠŸèƒ½
               - ç›®å½•ç»“æž„è¯´æ˜Ž
               - å®‰è£…å’Œä½¿ç”¨æ–¹æ³•
               - API æ–‡æ¡£ï¼ˆå¦‚æžœæ˜¯æœåŠ¡/åº“ï¼‰
               - å¼€å‘æŒ‡å—å’Œè´¡çŒ®è¯´æ˜Ž

            ## ðŸ“ å†…å®¹è¦æ±‚
            - **è¯­è¨€**: ä½¿ç”¨ä¸­æ–‡ç¼–å†™
            - **é£Žæ ¼**: ç®€æ´å®žç”¨ï¼Œé‡ç‚¹çªå‡º
            - **ç»“æž„**: æ¸…æ™°çš„å±‚æ¬¡å’Œæ ¼å¼
            - **é’ˆå¯¹æ€§**:
              * å‰ç«¯ç›®å½•ï¼šé‡ç‚¹è¯´æ˜Žç»„ä»¶ã€é¡µé¢ã€è·¯ç”±
              * åŽç«¯ç›®å½•ï¼šé‡ç‚¹è¯´æ˜Ž APIã€æœåŠ¡ã€æ•°æ®æ¨¡åž‹
              * å·¥å…·ç›®å½•ï¼šé‡ç‚¹è¯´æ˜Žä½¿ç”¨æ–¹æ³•å’Œé…ç½®

            ## ðŸ”„ æ›´æ–°ç­–ç•¥
            - å¦‚æžœç›®å½•å·²æœ‰ README.mdï¼Œæ™ºèƒ½æ›´æ–°è€Œä¸æ˜¯å®Œå…¨è¦†ç›–
            - ä¿ç•™ç”¨æˆ·è‡ªå®šä¹‰çš„é‡è¦å†…å®¹
            - å¢žå¼ºå’Œè¡¥å……ç¼ºå¤±çš„æ ‡å‡†ä¿¡æ¯

            ## ðŸ“¦ é¡¹ç›®ä¸Šä¸‹æ–‡
            **InfiniteScribe** - AI é©±åŠ¨çš„å°è¯´å†™ä½œå¹³å°
            - åŽç«¯ï¼šPython 3.11 + FastAPI + SQLAlchemy
            - å‰ç«¯ï¼šReact 18 + TypeScript + Vite
            - æž¶æž„ï¼šå¾®æœåŠ¡ + äº‹ä»¶é©±åŠ¨

            ## âœ… å®Œæˆæ“ä½œ
            ç›´æŽ¥æäº¤ç”Ÿæˆçš„ README æ–‡ä»¶åˆ°å½“å‰åˆ†æ”¯ï¼Œæäº¤ä¿¡æ¯ï¼š
            `docs: auto-generate README files for changed directories`

          # å…è®¸çš„å·¥å…·é›†
          claude_args: |
            --model ${{ vars.GLM_MODEL }}
            --allowedTools "Bash(git add:*),Bash(git commit:*),Bash(git status:*),Bash(git diff:*)"

          allowed_tools: >
            Bash(git add:*),
            Bash(git commit:*),
            Bash(git status:*),
            Bash(git diff:*),
            Bash(git push:*)
          model: ${{ vars.GLM_MODEL }}
          settings: |
            {
              "env": {
                "ANTHROPIC_BASE_URL": "${{ vars.GLM_BASE_URL }}"
              }
            }
