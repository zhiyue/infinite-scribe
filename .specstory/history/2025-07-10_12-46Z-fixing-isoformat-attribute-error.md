<!-- Generated by SpecStory -->

# Fixing isoformat attribute error (2025-07-10 12:46Z)

_**User**_

For the code present, we get this error:
```
"isoformat" is not a known attribute of "None"
```
How can I resolve this? If you propose a fix, please make it concise.

---

_**Assistant**_

<think><details><summary>Thought Process</summary>The user is getting an error about `isoformat` not being a known attribute of `None`. Looking at the code, I can see the issue is on line 178:

```python
"locked_until": user.locked_until.isoformat(),
```

The error suggests that `user.locked_until` might be `None`. Looking at the context, this is within a block where the user has too many failed login attempts and the account is being locked. The code right before this sets:

```python
user.locked_until = utc_now() + timedelta(minutes=settings.auth.account_lockout_duration_minutes)
```

So `user.locked_until` should have been set to a datetime object. But the type checker/linter is saying it could be `None`.

This could happen if:
1. The `locked_until` field is nullable in the database schema
2. The type annotation allows `None`
3. There's a race condition or some other issue

The fix is simple - we need to check if `user.locked_until` is not None before calling `.isoformat()` on it. Since we just set it above, we can either:
1. Add a null check with a fallback
2. Cast it to the expected type since we know it's not None at this point
3. Use a more defensive approach

Given the context, the most concise fix would be to add a null check or use the fact that we know it's not None since we just set it.

Looking at the broader context, the user service is setting `user.locked_until` just before this line, so we know it's not None. The simplest fix would be to add a type assertion or null check.</details></think>

---

Looking at the error, `user.locked_until` might be `None` when you try to call `.isoformat()` on it. Since you just set `user.locked_until` a few lines above, you can fix this with a simple null check:

---



---



---

